import{r as l,j as e,H as C,a as n,V as t}from"./app-6QK0mXQ1.js";import{D as I,F as E,a as F,b as D}from"./DashboardLayout-nol83AhG.js";function $(){const[g,f]=l.useState([]),[y,d]=l.useState(!1),[a,i]=l.useState({app_name:"",whitelisted_ips:"",description:""}),[u,x]=l.useState(!1),[c,o]=l.useState(null),[h,w]=l.useState(null),[m,b]=l.useState(null),p=async()=>{try{const s=await n.get("/api/v1/auth-apps");f(s.data.data)}catch{t.error("Failed to load apps")}};l.useEffect(()=>{p()},[]);const N=async s=>{var r;s.preventDefault(),x(!0);try{c?(await n.put(`/api/v1/auth-apps/${c}`,a),t.success("App updated successfully!")):(await n.post("/api/v1/generate-token",a),t.success("Token generated successfully!")),i({app_name:"",whitelisted_ips:"",description:""}),d(!1),o(null),p()}catch(j){((r=j.response)==null?void 0:r.status)===422?Object.values(j.response.data.messages).flat().forEach(S=>t.error(S)):t.error("Something went wrong.")}finally{x(!1)}},v=s=>{i({app_name:s.app_name,whitelisted_ips:s.whitelisted_ips.join(", "),description:s.description||""}),o(s.id),d(!0)},k=async s=>{try{await n.patch(`/api/v1/auth-apps/${s}/status`),t.success("Status updated!"),p()}catch{t.error("Failed to update status.")}},A=async s=>{if(confirm("Are you sure you want to delete this app?"))try{await n.delete(`/api/v1/auth-apps/${s}`),t.success("App deleted."),p()}catch{t.error("Failed to delete.")}},_=s=>{navigator.clipboard.writeText(s),t.success("Token copied!")};return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Authorized Apps"}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-700",children:"Authorized Apps"}),e.jsxs("button",{onClick:()=>{i({app_name:"",whitelisted_ips:"",description:""}),o(null),d(!0)},className:"bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800 flex items-center gap-2",children:[e.jsx(E,{})," New App"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white shadow rounded-lg p-4",children:e.jsxs("table",{className:"min-w-full table-auto text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 px-4",children:"App Name"}),e.jsx("th",{className:"py-2 px-4",children:"Token"}),e.jsx("th",{className:"py-2 px-4",children:"Whitelisted IPs"}),e.jsx("th",{className:"py-2 px-4",children:"Status"}),e.jsx("th",{className:"py-2 px-4",children:"Last Access"}),e.jsx("th",{className:"py-2 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(s=>{var r;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4",children:s.app_name}),e.jsxs("td",{className:"py-2 px-4 text-xs",children:[m===s.id?e.jsx("span",{className:"break-all",children:s.token}):"••••••••••••••••",e.jsx("button",{className:"ml-2 text-blue-600 hover:text-blue-800",onClick:()=>{m===s.id?b(null):(b(s.id),_(s.token))},title:"Copy token",children:e.jsx(F,{})})]}),e.jsx("td",{className:"py-2 px-4",children:(r=s.whitelisted_ips)==null?void 0:r.join(", ")}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs ${s.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status?"Active":"Inactive"})}),e.jsx("td",{className:"py-2 px-4",children:s.last_accessed_at||"Never"}),e.jsxs("td",{className:"py-2 px-4 relative",children:[e.jsx("button",{onClick:()=>w(h===s.id?null:s.id),children:e.jsx(D,{})}),h===s.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-white border rounded shadow z-10",children:[e.jsx("button",{className:"block w-full text-left px-4 py-2 hover:bg-gray-100",onClick:()=>v(s),children:"Edit"}),e.jsx("button",{className:"block w-full text-left px-4 py-2 hover:bg-gray-100",onClick:()=>k(s.id),children:s.status?"Deactivate":"Activate"}),e.jsx("button",{className:"block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50",onClick:()=>A(s.id),children:"Delete"})]})]})]},s.id)})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-green-700 mb-4",children:c?"Edit App":"Register New App"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"App Name"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded p-2",value:a.app_name,onChange:s=>i({...a,app_name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Whitelisted IPs"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded p-2",placeholder:"Comma separated",value:a.whitelisted_ips,onChange:s=>i({...a,whitelisted_ips:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Description"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded p-2",rows:3,value:a.description,onChange:s=>i({...a,description:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"text-gray-600 hover:text-black",onClick:()=>{d(!1),o(null)},disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800",disabled:u,children:u?"Submitting...":c?"Update":"Submit"})]})]})]})})]})]})}export{$ as default};
