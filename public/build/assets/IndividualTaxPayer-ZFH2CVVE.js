import{r,j as e,H as A,O as P,L as O,V as x}from"./app-TVSjaBxv.js";import{D as M,d as E}from"./DashboardLayout-DkjjvAXQ.js";import{D as w,u as y,w as I,F as $}from"./FileSaver.min-DKW4GbLb.js";import"./index-wnL1HFxL.js";function V(){const[n,u]=r.useState(1),[c,S]=r.useState(""),[p,_]=r.useState(""),[D,T]=r.useState([]),[j,N]=r.useState(!1),[i,C]=r.useState(()=>{const a=new Date;return a.setDate(a.getDate()-6),a}),[o,L]=r.useState(new Date),h=100;r.useEffect(()=>{(async()=>{N(!0);try{const t=await fetch("api/jtb/individuals",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({fromDate:i,toDate:o})}),s=await t.json();console.log("Response data:",s),t.ok&&s.ResponseCode==="001"?Array.isArray(s.TaxpayerList)?(T(s.TaxpayerList),x.success(`Successfully loaded ${s.TaxpayerList.length} taxpayers`)):x.error("Invalid data format received"):x.error(s.ResponseDescription||"Failed to load taxpayers")}catch(t){console.error("Fetch error:",t),x.error("Network error occurred while fetching taxpayers")}finally{N(!1)}})()},[i,o]);const d=D.filter(a=>{var b,f,v;const t=((b=a.tin)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((f=a.first_name)==null?void 0:f.toLowerCase().includes(c.toLowerCase()))||((v=a.last_name)==null?void 0:v.toLowerCase().includes(c.toLowerCase())),s=p===""||a.TaxpayerStatus===p,l=new Date(a.date_of_registration),F=l>=i&&l<=o;return t&&s&&F});console.log("Filtered taxpayers count:",d.length);const m=Math.ceil(d.length/h),g=d.slice((n-1)*h,n*h),k=()=>{const a=y.json_to_sheet(d),t=y.book_new();y.book_append_sheet(t,a,"Taxpayers");const s=I(t,{bookType:"xlsx",type:"array"}),l=new Blob([s],{type:"application/octet-stream"});$.saveAs(l,"individual_taxpayers.xlsx")};return e.jsxs(M,{children:[e.jsx(A,{title:"Individual Taxpayers"}),e.jsx(P,{position:"top-right"}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6",children:[e.jsx(O,{href:"/dashboard",className:"bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800",children:"← Back to Dashboard"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center border px-2 py-1 rounded",children:[e.jsx(E,{className:"text-gray-500 mr-2"}),e.jsx("input",{type:"text",value:c,onChange:a=>S(a.target.value),placeholder:"Search by TIN or Name",className:"px-2 py-1 outline-none"})]}),e.jsxs("select",{value:p,onChange:a=>_(a.target.value),className:"border px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]}),e.jsx(w,{selected:i,onChange:C,dateFormat:"dd-MM-yyyy",className:"border px-3 py-2 rounded text-sm",placeholderText:"From Date"}),e.jsx(w,{selected:o,onChange:L,dateFormat:"dd-MM-yyyy",className:"border px-3 py-2 rounded text-sm",placeholderText:"To Date"}),e.jsx("button",{onClick:k,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Export to Excel"})]})]}),j?e.jsx("div",{className:"text-center text-gray-600 py-12",children:"Loading taxpayers..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded shadow border text-sm",children:[e.jsx("thead",{className:"bg-green-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"TIN"}),e.jsx("th",{className:"px-2 py-1",children:"Full Name"}),e.jsx("th",{className:"px-2 py-1",children:"Gender"}),e.jsx("th",{className:"px-2 py-1",children:"DOB"}),e.jsx("th",{className:"px-2 py-1",children:"Phone 1"}),e.jsx("th",{className:"px-2 py-1",children:"Phone 2"}),e.jsx("th",{className:"px-2 py-1",children:"Email"}),e.jsx("th",{className:"px-2 py-1",children:"Nationality"}),e.jsx("th",{className:"px-2 py-1",children:"Marital Status"}),e.jsx("th",{className:"px-2 py-1",children:"Occupation"}),e.jsx("th",{className:"px-2 py-1",children:"LGA"}),e.jsx("th",{className:"px-2 py-1",children:"State"}),e.jsx("th",{className:"px-2 py-1",children:"State of Origin"}),e.jsx("th",{className:"px-2 py-1",children:"City"}),e.jsx("th",{className:"px-2 py-1",children:"Street"}),e.jsx("th",{className:"px-2 py-1",children:"House No"}),e.jsx("th",{className:"px-2 py-1",children:"Tax Authority"}),e.jsx("th",{className:"px-2 py-1",children:"Status"}),e.jsx("th",{className:"px-2 py-1",children:"Registration Date"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"19",className:"text-center py-4 text-gray-500",children:"No taxpayers found."})}):g.map((a,t)=>{var s,l;return e.jsxs("tr",{className:"hover:bg-gray-100 border-b text-xs",children:[e.jsx("td",{className:"px-2 py-1",children:a.tin}),e.jsx("td",{className:"px-2 py-1",children:`${a.Title||""} ${a.first_name||""} ${a.middle_name||""} ${a.last_name||""}`}),e.jsx("td",{className:"px-2 py-1",children:a.GenderName}),e.jsx("td",{className:"px-2 py-1",children:(s=a.date_of_birth)==null?void 0:s.slice(0,10)}),e.jsx("td",{className:"px-2 py-1",children:a.phone_no_1}),e.jsx("td",{className:"px-2 py-1",children:a.phone_no_2||"—"}),e.jsx("td",{className:"px-2 py-1",children:a.email_address}),e.jsx("td",{className:"px-2 py-1",children:a.nationality_name}),e.jsx("td",{className:"px-2 py-1",children:a.MaritalStatus}),e.jsx("td",{className:"px-2 py-1",children:a.Occupation}),e.jsx("td",{className:"px-2 py-1",children:a.LGAName}),e.jsx("td",{className:"px-2 py-1",children:a.StateName}),e.jsx("td",{className:"px-2 py-1",children:a.StateOfOrigin}),e.jsx("td",{className:"px-2 py-1",children:a.city}),e.jsx("td",{className:"px-2 py-1",children:a.street_name}),e.jsx("td",{className:"px-2 py-1",children:a.house_number}),e.jsx("td",{className:"px-2 py-1",children:a.TaxAuthorityName}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${a.TaxpayerStatus==="Active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.TaxpayerStatus})}),e.jsx("td",{className:"px-2 py-1",children:(l=a.date_of_registration)==null?void 0:l.slice(0,10)})]},t)})})]})}),!j&&e.jsxs("div",{className:"flex justify-between items-center mt-4 text-sm",children:[e.jsx("button",{onClick:()=>u(a=>Math.max(a-1,1)),disabled:n===1,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Previous"}),e.jsxs("span",{className:"text-gray-700",children:["Page ",n," of ",m]}),e.jsx("button",{onClick:()=>u(a=>Math.min(a+1,m)),disabled:n===m,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Next"})]})]})]})}export{V as default};
