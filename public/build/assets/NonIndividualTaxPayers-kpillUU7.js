import{r,j as e,H as I,L as O,V as N}from"./app-TVSjaBxv.js";import{D as B,d as H}from"./DashboardLayout-DkjjvAXQ.js";import{D as T,u as j,w as R,F as Y}from"./FileSaver.min-DKW4GbLb.js";import"./index-wnL1HFxL.js";function $(){const g=new Date,f=new Date;f.setDate(g.getDate()-6);const[C,F]=r.useState([]),[p,L]=r.useState(""),[h,P]=r.useState(""),[n,k]=r.useState(f),[d,E]=r.useState(g),[l,_]=r.useState(1),[M,v]=r.useState(!1),y=10;r.useEffect(()=>{n&&d&&(async()=>{var o,x;if((d-n)/(1e3*60*60*24)>7){N.error("The date range cannot exceed 7 days.");return}v(!0);try{const c=await fetch("/api/jtb/non-individuals",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({fromDate:n.toISOString().split("T")[0],toDate:d.toISOString().split("T")[0]})});if(!c.ok)throw new Error("Failed to fetch");const s=await c.json();F((s==null?void 0:s.TaxpayerList)||[]),console.log("First taxpayer record:",(o=s==null?void 0:s.TaxpayerList)==null?void 0:o[0]),N.success(`${((x=s==null?void 0:s.TaxpayerList)==null?void 0:x.length)||0} record(s) loaded`)}catch(c){console.error("Error fetching non-individual taxpayers:",c),N.error("Failed to fetch non-individual taxpayer data.")}finally{v(!1)}})()},[n,d]);const m=a=>{const t=new Date(a);return t.setHours(0,0,0,0),t},u=C.filter(a=>{var D,S;const t=((D=a.tin)==null?void 0:D.toLowerCase().includes(p.toLowerCase()))||((S=a.registered_name)==null?void 0:S.toLowerCase().includes(p.toLowerCase())),i=h===""||a.TaxpayerStatus===h,o=m(a.date_of_registration),x=m(n),c=m(d),s=o>=x&&o<=c;return t&&i&&s}),b=Math.ceil(u.length/y),w=u.slice((l-1)*y,l*y),A=()=>{const a=j.json_to_sheet(u),t=j.book_new();j.book_append_sheet(t,a,"Taxpayers");const i=R(t,{bookType:"xlsx",type:"array"}),o=new Blob([i],{type:"application/octet-stream"});Y.saveAs(o,"non_individual_taxpayers.xlsx")};return e.jsxs(B,{children:[e.jsx(I,{title:"Non-Individual Taxpayers"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6",children:[e.jsx(O,{href:"/dashboard",className:"bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800",children:"â† Back to Dashboard"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center border px-2 py-1 rounded",children:[e.jsx(H,{className:"text-gray-500 mr-2"}),e.jsx("input",{type:"text",value:p,onChange:a=>L(a.target.value),placeholder:"Search TIN or Name",className:"px-2 py-1 outline-none"})]}),e.jsxs("select",{value:h,onChange:a=>P(a.target.value),className:"border px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Deactivated",children:"Deactivated"}),e.jsx("option",{value:"Pending",children:"Pending"})]}),e.jsx(T,{selected:n,onChange:a=>k(a),dateFormat:"dd-MM-yyyy",className:"border px-3 py-2 rounded text-sm",placeholderText:"From Date"}),e.jsx(T,{selected:d,onChange:a=>E(a),dateFormat:"dd-MM-yyyy",className:"border px-3 py-2 rounded text-sm",placeholderText:"To Date"}),e.jsx("button",{onClick:A,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Export to Excel"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded shadow border text-sm",children:[e.jsx("thead",{className:"bg-green-700 text-white",children:e.jsx("tr",{children:["TIN","Registered Name","Main Trade Name","Org Name","Reg No.","Phone 1","Phone 2","Email","LOB Code","LOB Name","Reg Date","Commencement","Incorporation","House No.","Street","City","LGA","State","Country","FY Start","FY End","Director Name","Director Phone","Director Email","Tax Auth Code","Tax Auth Name","Status"].map((a,t)=>e.jsx("th",{className:"border px-2 py-1 text-left whitespace-nowrap",children:a},t))})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:"27",className:"text-center py-4",children:"Loading..."})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"27",className:"text-center py-4",children:"No data found."})}):w.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border px-2 py-1",children:a.tin}),e.jsx("td",{className:"border px-2 py-1",children:a.registered_name}),e.jsx("td",{className:"border px-2 py-1",children:a.main_trade_name}),e.jsx("td",{className:"border px-2 py-1",children:a.org_name}),e.jsx("td",{className:"border px-2 py-1",children:a.registration_number}),e.jsx("td",{className:"border px-2 py-1",children:a.phone_no_1}),e.jsx("td",{className:"border px-2 py-1",children:a.phone_no_2||"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.email_address}),e.jsx("td",{className:"border px-2 py-1",children:a.line_of_business_code}),e.jsx("td",{className:"border px-2 py-1",children:a.lob_name}),e.jsx("td",{className:"border px-2 py-1",children:a.date_of_registration}),e.jsx("td",{className:"border px-2 py-1",children:a.commencement_date}),e.jsx("td",{className:"border px-2 py-1",children:a.date_of_incorporation}),e.jsx("td",{className:"border px-2 py-1",children:a.house_number}),e.jsx("td",{className:"border px-2 py-1",children:a.street_name}),e.jsx("td",{className:"border px-2 py-1",children:a.city}),e.jsx("td",{className:"border px-2 py-1",children:a.LGAName}),e.jsx("td",{className:"border px-2 py-1",children:a.StateName}),e.jsx("td",{className:"border px-2 py-1",children:a.CountryName}),e.jsx("td",{className:"border px-2 py-1",children:a.FinYrBegin}),e.jsx("td",{className:"border px-2 py-1",children:a.FinYrEnd}),e.jsx("td",{className:"border px-2 py-1",children:a.director_name||"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.director_phone||"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.director_email||"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.TaxAuthorityCode}),e.jsx("td",{className:"border px-2 py-1",children:a.TaxAuthorityName}),e.jsx("td",{className:"border px-2 py-1",children:a.TaxpayerStatus})]},t))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-sm",children:[e.jsx("button",{onClick:()=>_(a=>Math.max(a-1,1)),disabled:l===1,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Previous"}),e.jsxs("span",{className:"text-gray-700",children:["Page ",l," of ",b]}),e.jsx("button",{onClick:()=>_(a=>Math.min(a+1,b)),disabled:l===b,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Next"})]})]})]})}export{$ as default};
