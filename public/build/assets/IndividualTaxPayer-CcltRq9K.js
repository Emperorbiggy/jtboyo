import{r,j as e,H as P,L}from"./app-Be7Panv-.js";import{D as F,d as E}from"./DashboardLayout-CAsHHpFK.js";import{D as _,u as y,w as M,F as H}from"./FileSaver.min-B539ejjy.js";import"./index-D4TWy6Dx.js";function R(){const[l,u]=r.useState(1),[j,v]=r.useState(""),[d,S]=r.useState(""),[D,x]=r.useState([]),[c,T]=r.useState(()=>{const s=new Date;return s.setDate(s.getDate()-30),s.setHours(0,0,0,0),s}),[i,C]=r.useState(()=>{const s=new Date;return s.setHours(23,59,59,999),s}),p=100;r.useEffect(()=>{c&&i&&(async()=>{try{const a=await(await fetch("/api/jtb/individuals",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({fromDate:c,toDate:i})})).json();console.log("Fetched data:",a),a.success&&a.data&&Array.isArray(a.data.data)?x(a.data.data):(console.warn("Unexpected data shape:",a),x([]))}catch(t){console.error("Error fetching taxpayers:",t),x([])}})()},[c,i]);const h=D.filter(s=>{var g,b,f,w;const t=j.trim().toLowerCase(),a=((g=s.tin)==null?void 0:g.toLowerCase().includes(t))||((b=s.first_name)==null?void 0:b.toLowerCase().includes(t))||((f=s.last_name)==null?void 0:f.toLowerCase().includes(t)),n=d===""||((w=s.TaxpayerStatus)==null?void 0:w.toLowerCase())===d.toLowerCase(),o=s.date_of_registration?new Date(s.date_of_registration):null,A=!o||(o.setHours(0,0,0,0),o>=c&&o<=i);return a&&n&&A}),m=Math.ceil(h.length/p),N=h.slice((l-1)*p,l*p),k=()=>{const s=y.json_to_sheet(h),t=y.book_new();y.book_append_sheet(t,s,"Taxpayers");const a=M(t,{bookType:"xlsx",type:"array"}),n=new Blob([a],{type:"application/octet-stream"});H.saveAs(n,"individual_taxpayers.xlsx")};return e.jsxs(F,{children:[e.jsx(P,{title:"Individual Taxpayers"}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6",children:[e.jsx(L,{href:"/dashboard",className:"bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800",children:"← Back to Dashboard"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center border px-2 py-1 rounded",children:[e.jsx(E,{className:"text-gray-500 mr-2"}),e.jsx("input",{type:"text",value:j,onChange:s=>v(s.target.value),placeholder:"Search by TIN or Name",className:"px-2 py-1 outline-none"})]}),e.jsxs("select",{value:d,onChange:s=>S(s.target.value),className:"border px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]}),e.jsx(_,{selected:c,onChange:s=>{s.setHours(0,0,0,0),T(s)},dateFormat:"yyyy-MM-dd",className:"border px-3 py-2 rounded text-sm"}),e.jsx(_,{selected:i,onChange:s=>{s.setHours(23,59,59,999),C(s)},dateFormat:"yyyy-MM-dd",className:"border px-3 py-2 rounded text-sm"}),e.jsx("button",{onClick:k,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Export to Excel"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded shadow border text-sm",children:[e.jsx("thead",{className:"bg-green-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"TIN"}),e.jsx("th",{className:"px-2 py-1",children:"Full Name"}),e.jsx("th",{className:"px-2 py-1",children:"Gender"}),e.jsx("th",{className:"px-2 py-1",children:"DOB"}),e.jsx("th",{className:"px-2 py-1",children:"Phone 1"}),e.jsx("th",{className:"px-2 py-1",children:"Phone 2"}),e.jsx("th",{className:"px-2 py-1",children:"Email"}),e.jsx("th",{className:"px-2 py-1",children:"Nationality"}),e.jsx("th",{className:"px-2 py-1",children:"Marital Status"}),e.jsx("th",{className:"px-2 py-1",children:"Occupation"}),e.jsx("th",{className:"px-2 py-1",children:"LGA"}),e.jsx("th",{className:"px-2 py-1",children:"State"}),e.jsx("th",{className:"px-2 py-1",children:"State of Origin"}),e.jsx("th",{className:"px-2 py-1",children:"City"}),e.jsx("th",{className:"px-2 py-1",children:"Street"}),e.jsx("th",{className:"px-2 py-1",children:"House No"}),e.jsx("th",{className:"px-2 py-1",children:"Tax Authority"}),e.jsx("th",{className:"px-2 py-1",children:"Status"}),e.jsx("th",{className:"px-2 py-1",children:"Registration Date"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"19",className:"text-center py-4 text-gray-500",children:"No taxpayers found."})}):N.map((s,t)=>{var a,n;return e.jsxs("tr",{className:"hover:bg-gray-100 border-b text-xs",children:[e.jsx("td",{className:"px-2 py-1",children:s.tin}),e.jsx("td",{className:"px-2 py-1",children:[s.Title,s.first_name,s.middle_name,s.last_name].filter(Boolean).join(" ")}),e.jsx("td",{className:"px-2 py-1",children:s.GenderName}),e.jsx("td",{className:"px-2 py-1",children:(a=s.date_of_birth)==null?void 0:a.slice(0,10)}),e.jsx("td",{className:"px-2 py-1",children:s.phone_no_1}),e.jsx("td",{className:"px-2 py-1",children:s.phone_no_2||"—"}),e.jsx("td",{className:"px-2 py-1",children:s.email_address}),e.jsx("td",{className:"px-2 py-1",children:s.nationality_name}),e.jsx("td",{className:"px-2 py-1",children:s.MaritalStatus}),e.jsx("td",{className:"px-2 py-1",children:s.Occupation}),e.jsx("td",{className:"px-2 py-1",children:s.LGAName}),e.jsx("td",{className:"px-2 py-1",children:s.StateName}),e.jsx("td",{className:"px-2 py-1",children:s.StateOfOrigin}),e.jsx("td",{className:"px-2 py-1",children:s.city}),e.jsx("td",{className:"px-2 py-1",children:s.street_name}),e.jsx("td",{className:"px-2 py-1",children:s.house_number}),e.jsx("td",{className:"px-2 py-1",children:s.TaxAuthorityName}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.TaxpayerStatus==="Active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.TaxpayerStatus})}),e.jsx("td",{className:"px-2 py-1",children:(n=s.date_of_registration)==null?void 0:n.slice(0,10)})]},t)})})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-sm",children:[e.jsx("button",{onClick:()=>u(s=>Math.max(s-1,1)),disabled:l===1,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Previous"}),e.jsxs("span",{className:"text-gray-700",children:["Page ",l," of ",m]}),e.jsx("button",{onClick:()=>u(s=>Math.min(s+1,m)),disabled:l===m,className:"bg-green-600 text-white px-4 py-2 rounded disabled:bg-gray-300",children:"Next"})]})]})]})}export{R as default};
